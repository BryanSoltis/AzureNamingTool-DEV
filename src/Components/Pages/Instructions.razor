@page "/instructions"
@using AzureNamingTool.Components.Instructions
@using AzureNamingTool.Helpers
@using AzureNamingTool.Models
@using AzureNamingTool.Components.General
@inject StateContainer state
@inject ProtectedSessionStorage session
@inject IToastService toastService
@inject NavigationManager NavigationManager

<PageTitle>Azure Naming Tool - Instructions</PageTitle>

<div class="modern-card">
    <div class="modern-card-header">
        <h1 class="modern-page-title">
            <span class="oi oi-book" aria-hidden="true"></span>
            Instructions
        </h1>
    </div>
    <div class="modern-card-body">
        <div class="mb-4">This page provides instructions on how to configure and use the Azure Naming Tool.</div>
        
        @if (admin)
        {
            <div class="modern-card mb-3">
                <div class="modern-card-header modern-card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#adminpassword" aria-expanded="true">
                    <span class="oi oi-chevron-bottom modern-collapse-icon" aria-hidden="true"></span>
                    <span class="modern-card-title">Global Admin Password</span>
                </div>
                <div class="collapse show modern-card-body" id="adminpassword">
                    <AdminPasswordInstructions theme="@theme" admin="@admin" />
                </div>
            </div>
            
            <div class="modern-card mb-3">
                <div class="modern-card-header modern-card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#adminconfiguration" aria-expanded="true">
                    <span class="oi oi-chevron-bottom modern-collapse-icon" aria-hidden="true"></span>
                    <span class="modern-card-title">Admin Configuration</span>
                </div>
                <div class="collapse show modern-card-body" id="adminconfiguration">
                    <AdminConfigurationInstructions theme="@theme" admin="@admin" />
                </div>
            </div>
            
            <div class="modern-card mb-3">
                <div class="modern-card-header modern-card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#adminlog" aria-expanded="true">
                    <span class="oi oi-chevron-bottom modern-collapse-icon" aria-hidden="true"></span>
                    <span class="modern-card-title">Admin Log</span>
                </div>
                <div class="collapse show modern-card-body" id="adminlog">
                    <AdminLogInstructions theme="@theme" admin="@admin" />
                </div>
            </div>
        }
        
        <div class="modern-card mb-3">
            <div class="modern-card-header modern-card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#configuration" aria-expanded="true">
                <span class="oi oi-chevron-bottom modern-collapse-icon" aria-hidden="true"></span>
                <span class="modern-card-title">Configuration</span>
            </div>
            <div class="collapse show modern-card-body" id="configuration">
                <ConfigurationInstructions theme="@theme" admin="@admin" />
            </div>
        </div>
        
        <div class="modern-card mb-3">
            <div class="modern-card-header modern-card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#generate" aria-expanded="true">
                <span class="oi oi-chevron-bottom modern-collapse-icon" aria-hidden="true"></span>
                <span class="modern-card-title">Generate</span>
            </div>
            <div class="collapse show modern-card-body" id="generate">
                <GenerateInstructions theme="@theme" admin="@admin" />
            </div>
        </div>
        
        <div class="modern-card mb-3">
            <div class="modern-card-header modern-card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#generatednameslog" aria-expanded="true">
                <span class="oi oi-chevron-bottom modern-collapse-icon" aria-hidden="true"></span>
                <span class="modern-card-title">Generated Names Log</span>
            </div>
            <div class="collapse show modern-card-body" id="generatednameslog">
                <GeneratedNamesLogInstructions theme="@theme" admin="@admin" />
            </div>
        </div>
        
        <div class="modern-card mb-3">
            <div class="modern-card-header modern-card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#reference" aria-expanded="true">
                <span class="oi oi-chevron-bottom modern-collapse-icon" aria-hidden="true"></span>
                <span class="modern-card-title">Reference</span>
            </div>
            <div class="collapse show modern-card-body" id="reference">
                <ReferenceInstructions theme="@theme" admin="@admin" />
            </div>
        </div>
    </div>
</div>

<AnchorNavigation />
@code {
    [CascadingParameter]
    protected ThemeInfo? theme { get; set; }
    private bool admin = false;
    private SiteConfiguration config = ConfigurationHelper.GetConfigurationData();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var result = await session.GetAsync<bool>("admin");
            admin = (bool)result.Value;
            if (!Convert.ToBoolean(config.InstructionsEnabled) && !admin)
            {
                toastService.ShowWarning("The Instructions page is disabled in the site settings.");
                NavigationManager.NavigateTo("");
            }
            StateHasChanged();
        }
    }
}
