# Azure Naming Tool v5.0.0 Migration Guide

## Overview

Version 5.0.0 of the Azure Naming Tool introduces significant enhancements including a modern redesigned UI, SQLite database storage option, and Azure resource name validation capabilities. This guide will help you successfully migrate from previous versions to v5.0.0.

---

## üö® CRITICAL REQUIREMENTS - READ BEFORE PROCEEDING

### ‚ö†Ô∏è BACKUP EVERYTHING BEFORE STARTING
Before performing ANY migration steps, you **MUST** create complete backups:
- ‚úÖ Export configuration JSON from Admin page
- ‚úÖ Backup `repository` folder (if using file-based storage)
- ‚úÖ Backup `settings` folder
- ‚úÖ Backup custom logo and CSS files
- ‚úÖ Document admin passwords and API keys
- ‚úÖ Store all backups in a safe location OUTSIDE the installation directory

### üîÑ RESTART APPLICATION AFTER EACH MAJOR STEP
The application **MUST** be restarted at these critical points:
1. **After initial v5.0.0 deployment** - Restart to initialize new features
2. **After restoring configuration from JSON** - Restart to load restored settings
3. **After SQLite migration** - Restart to switch to new database (CRITICAL)

**How to restart:**
- **Azure App Service:** Azure Portal ‚Üí Your App Service ‚Üí Click **Restart**
- **Docker:** `docker restart azurenamingtool`
- **Stand-alone:** Stop and restart the application process

> **üí° Pro Tip:** After each restart, wait 30-60 seconds before accessing the application to ensure all services are fully initialized.

---

## Migration Steps

### Step 1: Backup Your Current Configuration

**‚ö†Ô∏è DO NOT SKIP THIS STEP - This is your safety net if anything goes wrong!**

Before upgrading, it's **CRITICAL** to backup your existing configuration to prevent any data loss. Complete ALL backup options below:

#### Option A: Using the Admin Page (Recommended - REQUIRED)

1. **Stop making changes** to your current configuration
2. Navigate to the **Admin** page in your current Azure Naming Tool installation
3. Go to the **Configuration** tab
4. Under **Backup/Restore Configuration**, click **Export Configuration (JSON)**
5. Save the downloaded JSON file to a safe location
6. **Verify the file:** Open the JSON file and confirm it contains your configuration data
7. **Store safely:** Keep this file in a secure location OUTSIDE your installation directory
8. **Note:** This backup includes all component configurations but excludes admin settings (passwords, API keys)

#### Option B: Manual File System Backup (Recommended - REQUIRED)

If using the file-based storage (default in v4.x):

1. **STOP the application** before copying files:
   - **Azure App Service:** Azure Portal ‚Üí Stop the App Service
   - **Docker:** `docker stop azurenamingtool`
   - **Stand-alone:** Stop the application process

2. Navigate to your installation directory
3. Copy the **entire `repository` folder** to a backup location
4. Copy the **entire `settings` folder** to preserve admin settings
5. Copy any custom files in `wwwroot/images/` and `wwwroot/css/`
6. Store these backups in a safe location OUTSIDE your installation directory
7. **Verify backups:** Ensure all files were copied successfully and are readable

8. **START the application** again if continuing to use the current version:
   - **Azure App Service:** Azure Portal ‚Üí Start the App Service
   - **Docker:** `docker start azurenamingtool`
   - **Stand-alone:** Start the application process

**Backup Checklist (Complete ALL items):**
- ‚úÖ Configuration JSON exported from Admin page AND verified
- ‚úÖ `repository` folder backed up (if applicable)
- ‚úÖ `settings` folder backed up (if applicable)
- ‚úÖ Custom logo files backed up (if customized)
- ‚úÖ Custom CSS files backed up (if customized)
- ‚úÖ Documentation of admin password and API keys created
- ‚úÖ All backup files verified and stored in secure location
- ‚úÖ Application restarted if it was stopped for backup

---

### Step 2: Backup Code Modifications/Customizations

If you have made any customizations to the Azure Naming Tool code:

1. **Document all code changes:**
   - Note any modified files in the `src` directory
   - Document custom components or services added
   - Save copies of modified CSS/styling files

2. **Export customizations:**
   - Custom logo: Located in `wwwroot/images/` (if modified)
   - Custom CSS: Check `wwwroot/css/` for any custom files
   - Modified resource types or components
   - Custom home content from Admin page

3. **Create a customization document:**
   - List all custom changes made
   - Note file paths and specific modifications
   - Document any custom API integrations or webhooks

---

### Step 3: Review Installation Process for Your Environment

Review the installation documentation for your specific deployment environment to ensure you understand the requirements for v5.0.0:

#### Supported Environments:
- **Azure App Service** - [Installation Guide](https://github.com/mspnp/AzureNamingTool/wiki/Installation-App-Service)
- **Azure Container Instance** - [Installation Guide](https://github.com/mspnp/AzureNamingTool/wiki/Installation-Container-Instance)
- **Docker** - [Installation Guide](https://github.com/mspnp/AzureNamingTool/wiki/Installation-Docker)
- **Stand-alone** - [Installation Guide](https://github.com/mspnp/AzureNamingTool/wiki/Installation-Stand-alone)

#### System Requirements:
- **.NET 8.0** Runtime (ASP.NET Core)
- Minimum 512MB RAM (1GB recommended)
- Persistent storage for database (file system or SQLite)

#### New in v5.0.0:
- Modern UI with improved performance
- SQLite database option for better scalability
- Azure validation integration (requires Azure authentication)
- Enhanced API capabilities

---

### Step 4: Deploy Using Your Desired Installation Process

**‚ö†Ô∏è Important:** Before deploying, ensure you have completed Steps 1-3 and have all backups verified and secured.

Choose your deployment method and follow the installation guide:

#### Azure App Service Deployment

1. **STOP the current App Service:**
   - Go to Azure Portal ‚Üí Your App Service
   - Click **Stop** and wait for it to fully stop
   - This prevents file conflicts during deployment

2. Download the latest v5.0.0 release from [GitHub Releases](https://github.com/mspnp/AzureNamingTool/releases)

3. Extract the files to a local directory

4. Deploy to Azure App Service using one of these methods:
   - **Visual Studio:** Right-click project ‚Üí Publish
   - **Azure CLI:** `az webapp deploy --resource-group <rg-name> --name <app-name> --src-path <zip-file> --restart true`
   - **GitHub Actions:** Use provided workflow file
   - **Azure Portal:** Deploy from zip file

5. Configure App Settings:
   - Ensure `.NET 8` runtime is selected
   - Set `ASPNETCORE_ENVIRONMENT` if needed
   - Configure any custom environment variables

6. **START the App Service:**
   - Click **Start** in Azure Portal
   - Wait 30-60 seconds for the application to fully initialize
   - Verify the application loads by accessing the URL

4. Configure App Settings:
   - Ensure `.NET 8` runtime is selected
   - Set `ASPNETCORE_ENVIRONMENT` if needed
   - Configure any custom environment variables

6. **START the App Service:**
   - Click **Start** in Azure Portal
   - Wait 30-60 seconds for the application to fully initialize
   - Verify the application loads by accessing the URL

#### Docker Deployment

1. **STOP the current container (if running):**
   ```bash
   docker stop azurenamingtool
   docker rm azurenamingtool
   ```

2. Pull the latest v5.0.0 image:
   ```bash
   docker pull ghcr.io/mspnp/azurenamingtool:latest
   ```

3. Run with persistent storage:
   ```bash
   docker run -d \
     -p 80:80 \
     -v $(pwd)/repository:/app/repository \
     -v $(pwd)/settings:/app/settings \
     --name azurenamingtool \
     ghcr.io/mspnp/azurenamingtool:latest
   ```

4. **Verify container started:**
   ```bash
   docker ps
   docker logs azurenamingtool
   ```

5. Wait 30-60 seconds, then access the application at `http://localhost`

#### Stand-alone Deployment

1. **STOP the current application (if running):**
   - Press Ctrl+C in the terminal/console
   - Or stop the Windows service if installed as a service
   - Ensure the process is fully stopped

2. Ensure .NET 8.0 Runtime is installed
3. Extract the release files
4. **START the application:**
   ```bash
   dotnet AzureNamingTool.dll
   ```
5. Wait 30-60 seconds for initialization
6. Access the application at `http://localhost:5000`

> **ÔøΩ CRITICAL:** After deployment completes and the application starts, you **MUST** restart it again before proceeding to Step 5. This ensures all v5.0.0 features are properly initialized.
>
> **Restart again now:**
> - **Azure App Service:** Azure Portal ‚Üí Restart
> - **Docker:** `docker restart azurenamingtool`
> - **Stand-alone:** Stop (Ctrl+C) and run `dotnet AzureNamingTool.dll` again

---

### Step 5: Restore Your Configuration (JSON)

After successfully deploying v5.0.0 **and restarting the application**, restore your configuration:

**Prerequisites:**
- ‚úÖ v5.0.0 is deployed and running
- ‚úÖ Application has been restarted at least once
- ‚úÖ You have your configuration JSON backup file ready

#### Restoration Process

1. **Access the Admin page:**
   - Navigate to your new v5.0.0 installation
   - Log in with the default password (or your existing password if preserved)

2. **Navigate to Configuration tab:**
   - Click on **Admin** in the navigation
   - Select the **Configuration** tab
   - Scroll to **Backup/Restore Configuration**

3. **Import your configuration:**
   - Under **Restore Configuration from JSON**, click **Choose File**
   - Select your previously exported JSON backup file
   - Click **Restore Configuration from JSON Backup**
   - Confirm the restoration when prompted

4. **Verify the restoration:**
   - Wait for the success message
   - Don't navigate away immediately

5. **üîÑ RESTART THE APPLICATION (REQUIRED):**
   
   **This step is CRITICAL - the application MUST be restarted after restoring configuration!**
   
   - **Azure App Service:** 
     - Go to Azure Portal ‚Üí Your App Service
     - Click **Restart**
     - Wait for restart to complete (60-90 seconds)
   
   - **Docker:** 
     ```bash
     docker restart azurenamingtool
     ```
     Wait 60 seconds after restart
   
   - **Stand-alone:** 
     - Stop the application (Ctrl+C)
     - Wait 10 seconds
     - Restart with `dotnet AzureNamingTool.dll`

6. **Verify after restart:**
   - Log back into the application
   - Navigate to the **Configuration** page
   - Verify all components are loaded correctly
   - Check **Reference** page to ensure resource types display properly
   - Test name generation on the **Generate** page
   - Confirm custom settings are preserved

> **‚ö†Ô∏è Warning:** If you skip the restart after restoring configuration, some settings may not be properly loaded and the application may not function correctly.

---

### Step 6: Upgrading Your Installation to SQLite (Optional)

v5.0.0 introduces SQLite database support for improved performance and reliability. This is optional but recommended for production environments.

> **‚ö†Ô∏è WARNING:** 
> - Migrating to SQLite is a **ONE-WAY** operation
> - **BACKUP EVERYTHING** before proceeding (even if you just did in Step 1)
> - The application **MUST BE RESTARTED** after migration completes
> - Ensure you have adequate disk space (at least 2x your current data size)

#### Prerequisites

1. **Complete Steps 1-5** (Deploy v5.0.0 and restore configuration)
2. **Create a NEW backup** of your current configuration (even if already on v5.0.0):
   - Export Configuration JSON from Admin page
   - Save with a name like `pre-sqlite-backup-[date].json`
   - Store in a safe location
3. **Ensure the application is running** on file-based storage (default)
4. **Verify disk space** is available (check storage size in Azure or local disk)

#### Pre-Migration Backup (REQUIRED)

**DO NOT proceed without completing this backup:**

1. **Stop making any changes** to your configuration
2. Navigate to **Admin** ‚Üí **Configuration** tab
3. Under **Backup/Restore Configuration**, click **Export Configuration (JSON)**
4. Save as `pre-sqlite-backup-[date].json`
5. **Verify the backup file** is complete and readable
6. Store in a secure location

#### Migration Process

1. **Access Admin page:**
   - Navigate to **Admin** ‚Üí **Configuration** tab
   - Scroll to **Storage Migration** section

2. **Review migration information:**
   - Current storage provider is shown (should be "FileSystem")
   - Read the migration warnings and requirements carefully
   - Ensure you understand this is a one-way operation

3. **Create pre-migration backup (if not done above):**
   - Click **Export Configuration (JSON)** one more time
   - This is your last safety net before migration

4. **Initiate migration:**
   - Click **Migrate to SQLite**
   - You will see two confirmation prompts:
     - First confirmation: Acknowledge the migration process
     - Second confirmation: Type `MIGRATE` to proceed
   - Click **Confirm** on both prompts
   - **DO NOT close the browser or navigate away during migration**

5. **Monitor migration progress:**
   - The migration process will:
     - Export current configuration to JSON
     - Initialize SQLite database
     - Import all data to SQLite
     - Update storage provider setting
   - This may take several minutes depending on data size
   - Wait for the success message before proceeding

6. **üîÑ RESTART THE APPLICATION (ABSOLUTELY CRITICAL):**
   
   **The application WILL NOT work with SQLite until it is restarted!**
   
   - **Azure App Service:** 
     - Go to Azure Portal ‚Üí Your App Service
     - Click **Stop** and wait for it to fully stop
     - Click **Start** and wait 60-90 seconds
   
   - **Docker:** 
     ```bash
     docker stop azurenamingtool
     # Wait 10 seconds
     docker start azurenamingtool
     # Wait 60 seconds
     ```
   
   - **Stand-alone:** 
     - Stop the application (Ctrl+C)
     - Wait 10 seconds for cleanup
     - Restart with `dotnet AzureNamingTool.dll`
     - Wait 60 seconds for initialization

7. **Verify migration (after restart):**
   - **Wait 60-90 seconds** after restart before testing
   - Log back into the Admin page
   - Check **Admin** ‚Üí **Configuration** tab ‚Üí **Storage Migration** section
   - Verify "Current Storage Provider" shows **SQLite**
   - Navigate to **Configuration** page and verify all components loaded
   - Test name generation to ensure functionality
   - Check Generated Names Log (if you had entries before)
   - Test all major features before proceeding

> **‚ö†Ô∏è If application doesn't work after restart:**
> 1. Check Admin Logs for errors
> 2. Verify `azurenamingtool.db` file exists in the application directory
> 3. Check file permissions on the database file
> 4. If issues persist, use the Rollback Procedure below

#### Post-Migration Cleanup (Optional)

After successful migration and verification (wait at least 24-48 hours):

1. The original file-based storage remains in the `repository` folder
2. You can archive this folder for long-term backup purposes
3. **DO NOT delete until:**
   - SQLite has been working correctly for several days
   - You have multiple backups of the SQLite database
   - You are confident you won't need to rollback

#### Rollback Procedure

If you need to rollback from SQLite to file-based storage:

1. **STOP the application:**
   - **Azure App Service:** Azure Portal ‚Üí Stop
   - **Docker:** `docker stop azurenamingtool`
   - **Stand-alone:** Stop the process (Ctrl+C)

2. **Restore backup files:**
   - Restore your pre-migration backup JSON or files to the `repository` folder
   - Ensure all files are in place

3. **Remove SQLite database:**
   - Delete or rename the `azurenamingtool.db` file
   - This prevents the app from trying to use SQLite

4. **Update configuration:**
   - Edit `appsettings.json`
   - Find the storage provider setting
   - Change from "Sqlite" back to "FileSystem"

5. **START the application:**
   - **Azure App Service:** Azure Portal ‚Üí Start ‚Üí Wait 60 seconds
   - **Docker:** `docker start azurenamingtool` ‚Üí Wait 60 seconds
   - **Stand-alone:** Run `dotnet AzureNamingTool.dll` ‚Üí Wait 60 seconds

6. **Verify rollback:**
   - Log into Admin page
   - Check that FileSystem storage is active
   - Verify configuration loaded correctly

---

## What's New in v5.0.0

### Modern UI Redesign
- **New Dashboard:** Two-column hero layout with logo and custom content
- **Configuration Overview:** Stats grid showing all enabled component counts
- **Improved Navigation:** Streamlined modern tab interface
- **Better Mobile Support:** Responsive design improvements

### SQLite Database Support
- **Enhanced Performance:** Faster data access and queries
- **Better Scalability:** Handles larger configurations more efficiently
- **Improved Reliability:** Transactional support and data integrity
- **Easy Migration:** Built-in migration tool from file-based storage

### Azure Resource Name Validation
- **Real-time Validation:** Check if resource names already exist in Azure
- **Conflict Detection:** Prevent naming conflicts before deployment
- **Multi-subscription Support:** Validate across multiple Azure subscriptions
- **Configurable:** Enable/disable per your requirements

### Enhanced API Capabilities
- **Bulk Operations:** Process multiple naming requests in a single call
- **Improved Error Handling:** Better error messages and validation
- **Extended Filtering:** More options for querying configurations
- **Performance Improvements:** Faster response times

### Other Improvements
- **Fixed Component Name Matching:** Resolved issues with ResourceOrg, ResourceProjAppSvc, and ResourceFunction
- **Custom Home Content:** Now loads correctly in Admin page editor
- **Improved Logging:** Enhanced admin logs for troubleshooting
- **Better Error Messages:** More helpful error descriptions

---

## Troubleshooting

### Common Issues

#### Configuration Not Restored
**Symptom:** After importing JSON, components don't appear

**Solution:**
1. Verify the JSON file is valid and not corrupted
2. Check Admin Logs for any error messages
3. Restart the application after restoring
4. Try importing individual components using the Component Import feature

#### SQLite Migration Failed
**Symptom:** Migration process stops or shows errors

**Solution:**
1. Ensure you have a valid backup before retrying
2. Check available disk space (SQLite needs space to create database)
3. Review Admin Logs for specific error messages
4. If migration fails, the application remains on file-based storage
5. Contact support with error logs if issue persists

#### Application Won't Start After Migration
**Symptom:** Application fails to start after SQLite migration

**Solution:**
1. Check application logs for error details
2. Verify `azurenamingtool.db` file was created
3. Ensure file permissions allow read/write to database
4. Try rollback procedure (see Step 6)
5. Restore from pre-migration backup

#### Azure Validation Not Working
**Symptom:** Azure validation features are not available

**Solution:**
1. Ensure proper Azure authentication is configured
2. Check that Managed Identity or Service Principal has necessary permissions
3. Verify network connectivity to Azure Resource Manager
4. Review Admin ‚Üí Azure Validation settings
5. Check Admin Logs for authentication errors

---

## Post-Migration Checklist

After completing the migration, verify these items:

- ‚úÖ All resource components appear in Configuration page
- ‚úÖ Custom components (if any) are present
- ‚úÖ Resource types display correctly on Reference page
- ‚úÖ Name generation works on Generate page
- ‚úÖ Admin settings preserved (verify password, API keys)
- ‚úÖ Custom logo appears (if customized)
- ‚úÖ Custom home content displays on dashboard (if configured)
- ‚úÖ Generated Names Log contains previous entries (if applicable)
- ‚úÖ API endpoints respond correctly (test with Swagger)
- ‚úÖ Azure validation configured and working (if enabled)
- ‚úÖ Application performance is acceptable
- ‚úÖ All backups are stored safely and verified

---

## üìã Quick Reference: Critical Steps Summary

### Always BACKUP Before:
1. ‚úÖ **Before deploying v5.0.0** - Export JSON + backup folders
2. ‚úÖ **Before SQLite migration** - Export JSON again as safety net
3. ‚úÖ **Store backups safely** - Outside installation directory

### Always RESTART After:
1. üîÑ **After deploying v5.0.0** - Restart to initialize features
2. üîÑ **After restoring configuration** - Restart to load settings
3. üîÑ **After SQLite migration** - CRITICAL restart to switch database

### How to Stop/Start Application:
- **Azure App Service:** Portal ‚Üí Stop/Start (wait 60-90 seconds)
- **Docker:** `docker stop/start azurenamingtool` (wait 60 seconds)
- **Stand-alone:** Ctrl+C to stop, `dotnet AzureNamingTool.dll` to start

### Verification After Each Step:
1. ‚úÖ Wait 60 seconds after restart
2. ‚úÖ Access application URL
3. ‚úÖ Log into Admin page
4. ‚úÖ Check Configuration page loads
5. ‚úÖ Test name generation works

---

## Getting Help

If you encounter issues during migration:

1. **Check Admin Logs:** Admin page ‚Üí View Admin Log
2. **Review Documentation:** [Azure Naming Tool Wiki](https://github.com/mspnp/AzureNamingTool/wiki)
3. **Search Issues:** [GitHub Issues](https://github.com/mspnp/AzureNamingTool/issues)
4. **Report Bugs:** [Create New Issue](https://github.com/mspnp/AzureNamingTool/issues/new)
5. **Community Support:** Join discussions on GitHub

---

## Additional Resources

- [v5.0.0 Release Notes](https://github.com/mspnp/AzureNamingTool/wiki/v5.0.0)
- [Installation Guides](https://github.com/mspnp/AzureNamingTool/wiki/Installation)
- [Configuration Guide](https://github.com/mspnp/AzureNamingTool/wiki/Configuration)
- [API Documentation](https://github.com/mspnp/AzureNamingTool/wiki/API)
- [Azure Validation Guide](https://github.com/mspnp/AzureNamingTool/wiki/Azure-Validation)
- [Backup and Restore Guide](https://github.com/mspnp/AzureNamingTool/wiki/Backup-Restore)

---

**Last Updated:** November 4, 2025  
**Version:** 5.0.0
